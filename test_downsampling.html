<!DOCTYPE html>
<html>
<head>
    <title>Downsampling Test</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Downsampling Verification Test</h1>
    <div id="plot1" style="width:100%;height:400px;"></div>
    <div id="plot2" style="width:100%;height:400px;"></div>
    <div id="info"></div>

    <script>
        async function testDownsampling() {
            // Test with 1000 points from 100K dataset
            const response1 = await fetch('http://localhost:8000/api/volcano-data?dataset_size=100000&max_points=1000');
            const data1 = await response1.json();
            
            // Test with 20000 points from 100K dataset  
            const response2 = await fetch('http://localhost:8000/api/volcano-data?dataset_size=100000&max_points=20000');
            const data2 = await response2.json();

            // Plot 1: 1000 points
            const trace1 = {
                x: data1.data.map(d => d.logFC),
                y: data1.data.map(d => -Math.log10(d.padj)),
                mode: 'markers',
                type: 'scatter',
                name: '1000 points',
                marker: { size: 4 }
            };

            Plotly.newPlot('plot1', [trace1], {
                title: `1000 points sampled from ${data1.total_rows.toLocaleString()}`,
                xaxis: { title: 'Log2(FC)' },
                yaxis: { title: '-log10(p-value)' }
            });

            // Plot 2: 20000 points
            const trace2 = {
                x: data2.data.map(d => d.logFC),
                y: data2.data.map(d => -Math.log10(d.padj)),
                mode: 'markers',
                type: 'scatter',
                name: '20000 points',
                marker: { size: 2 }
            };

            Plotly.newPlot('plot2', [trace2], {
                title: `20000 points sampled from ${data2.total_rows.toLocaleString()}`,
                xaxis: { title: 'Log2(FC)' },
                yaxis: { title: '-log10(p-value)' }
            });

            document.getElementById('info').innerHTML = `
                <h3>Verification:</h3>
                <p><strong>Dataset 1:</strong> ${data1.total_rows.toLocaleString()} total → ${data1.data.length} displayed (${data1.is_downsampled ? 'downsampled' : 'not downsampled'})</p>
                <p><strong>Dataset 2:</strong> ${data2.total_rows.toLocaleString()} total → ${data2.data.length} displayed (${data2.is_downsampled ? 'downsampled' : 'not downsampled'})</p>
                <p><strong>Actual data points in browser:</strong> Plot 1 has ${data1.data.length} points, Plot 2 has ${data2.data.length} points</p>
            `;
        }

        testDownsampling();
    </script>
</body>
</html>